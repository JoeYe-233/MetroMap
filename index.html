<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ°é“å®æ—¶è¿è¡Œå›¾</title>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; overflow: hidden; background: #f5f5f5; }

        /* --- æ ¸å¿ƒæ§åˆ¶åŒºæ ·å¼ --- */
        /* --- æ ¸å¿ƒæ§åˆ¶åŒºæ ·å¼ --- */
        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%; /* æ”¹ç”¨å±…ä¸­å®šä½æ›´ç¨³ */
            transform: translateX(-50%); /* å±…ä¸­ */

            width: 90%;
            max-width: 900px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢ç”µè„‘ä¸Šçœ‹å¤ªå®½ */

            /* ã€å…³é”®ä¿®å¤ã€‘é˜²æ­¢ padding æ’‘å¤§ç›’å­ */
            box-sizing: border-box;

            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .status-bar { display: flex; justify-content: space-between; align-items: center; }
        .time-display { font-size: 1.2em; font-weight: bold; color: #333; font-variant-numeric: tabular-nums; }
        .mode-switch { font-size: 0.9em; color: #666; display: flex; align-items: center; gap: 5px; }

        /* ================= ä¿®æ”¹ï¼šè‡ªå®šä¹‰æ»‘å—æ ·å¼ (è§£å†³æ‰‹æŒ‡é®æŒ¡é—®é¢˜) ================= */
        .slider-wrapper {
            position: relative;
            width: 100%;
            height: 50px; /* æ•´ä¸ªè§¦æ§åŒºåŸŸé«˜åº¦ï¼Œè¶³å¤Ÿå¤§ä»¥ä¾¿æ‰‹æŒ‡æ“ä½œ */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* è§†è§‰å…ƒç´ é ä¸Š */
            margin-top: 5px;
        }

        /* 1. è§†è§‰è½¨é“ (ç»†çº¿/çª„çŸ©å½¢) */
        .visual-track {
            position: absolute;
            top: 12px; /* è·ç¦»é¡¶éƒ¨çš„ä½ç½® */
            left: 0;
            width: 100%;
            height: 4px; /* çº¿æ¡åšåº¦ */
            /* æ¼‚äº®çš„æ¸å˜è‰²: æ·±è“(æ·±å¤œ)-é»„(æ—©)-ç»¿(å¹³å³°)-æ©™(æ™š)-çº¢(åœè¿)-æ·±ç° */
            /* æ ¹æ®éçº¿æ€§æ¯”ä¾‹è°ƒæ•´é¢œè‰²åˆ†å¸ƒï¼š
            0% - 20%: æ—©é«˜å³°å‰ (ç°/é»„) - å¯¹åº”è¾ƒçŸ­é•¿åº¦
            20% - 35%: ç™½å¤©å¹³å³° (ç»¿) - å¯¹åº”æçŸ­é•¿åº¦ (è™½ç„¶æ—¶é—´é•¿ï¼Œä½†è¢«å‹ç¼©äº†)
            35% - 90%: æ™šé—´æ”¶è½¦ (æ©™/çº¢) - ğŸš¨ å æ®äº† 55% çš„é•¿åº¦ï¼Œéå¸¸æ˜¾çœ¼ä¸”çµæ•
            90% - 100%: æ·±å¤œ (æ·±ç°)
            */
            background: linear-gradient(to right,
                #34495e 0%,
                #f1c40f 20%,
                #2ecc71 20%,
                #2ecc71 35%,
                #e67e22 35%,
                #c0392b 90%,
                #2c3e50 90%
            );
            border-radius: 2px;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€è¿‡å» */
            z-index: 1;
        }

        /* 2. è§†è§‰æŒ‡é’ˆ (æŒ‡ç¤ºå½“å‰ä½ç½®) */
        .visual-thumb {
            position: absolute;
            top: 0;
            left: 0%; /* JS åŠ¨æ€æ§åˆ¶è¿™é‡Œ */
            width: 2px; /* æŒ‡é’ˆé‚£æ ¹çº¿çš„å®½åº¦ */
            height: 28px; /* æŒ‡é’ˆé«˜åº¦ï¼Œç©¿è¿‡è½¨é“ */
            background: #e74c3c; /* çº¢è‰²æŒ‡é’ˆ */
            z-index: 2;
            transform: translateX(-50%); /* å±…ä¸­å¯¹é½ */
            pointer-events: none;
            /* transition: left 0.1s linear;  æ‹–åŠ¨æ—¶ä¸ºäº†è·Ÿæ‰‹ï¼Œå»ºè®®å…³æ‰ CSS è¿‡æ¸¡ï¼Œæˆ–è€…åªåœ¨ tick æ—¶å¼€å¯ */
        }

        /* ç»™æŒ‡é’ˆåŠ ä¸ªâ€œå¤´â€ï¼Œçœ‹èµ·æ¥æ›´åƒæŒ‡é’ˆ */
        .visual-thumb::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* 3. å®é™…äº¤äº’çš„ Input (éšå½¢ã€å·¨å¤§) */
        input[type=range] {
            position: absolute;
            bottom: 0; /* æ”¾åœ¨åº•éƒ¨ï¼Œè®©ç”¨æˆ·æ‘¸ä¸‹é¢ */
            left: 0;
            width: 100%;
            height: 40px; /* è§¦æ§åŒºåŸŸé«˜åº¦ */
            opacity: 0; /* å®Œå…¨é€æ˜ï¼Œä¸å¯è§ */
            margin: 0;
            padding: 0;
            z-index: 3; /* åœ¨æœ€ä¸Šå±‚æ¥æ”¶ç‚¹å‡» */
            cursor: pointer;
        }

        #map-container {
            width: 100vw;
            height: 100vh;
            background: #f5f5f5;
            overflow: hidden;
            /* æŸäº›æµè§ˆå™¨ä¸‹èƒ½è¾…åŠ© GPU æ¸²æŸ“ */
            will-change: transform;
        }

        svg {
            width: 100%;
            height: 100%;
            display: block;
            /* ä¼˜åŒ– SVG æ¸²æŸ“é€Ÿåº¦ï¼Œç‰ºç‰²ä¸€ç‚¹ç‚¹å‡ ä½•ç²¾åº¦æ¢å–é€Ÿåº¦ */
            shape-rendering: auto;
        }

        /* å¦‚æœä½ çš„çº¿è·¯æ˜¯çº¯çº¿æ¡ï¼ŒåŠ ä¸Šè¿™ä¸ªå¯ä»¥è®©ç¼©æ”¾æ—¶çº¿æ¡ä¸è·Ÿç€å˜ç²— */
        /* path { vector-effect: non-scaling-stroke; } */

        /* è·¯å¾„è¿‡æ¸¡åŠ¨ç”» */
        path { transition: stroke 0.5s ease, opacity 0.5s ease, filter 0.5s ease; }
        rect { transition: fill 0.5s ease, stroke 0.5s ease, opacity 0.5s ease, filter 0.5s ease; }
        polygon { transition: fill 0.5s ease, stroke 0.5s ease, opacity 0.5s ease, filter 0.5s ease; }

        /* ================= æ ·å¼ä¿®æ­£ ================= */

        /* 1. é’ˆå¯¹çº¿è·¯ (æ‰€æœ‰ ID ä»¥ "seg_" å¼€å¤´çš„å…ƒç´ ) */
        [id^="seg_"].disabled {
            stroke: #dcdcdc !important;   /* çº¿æ¡å˜ç° */
            stroke-opacity: 0.3 !important;

            fill: none !important;        /* ğŸš¨ å…³é”®ï¼å¼ºåˆ¶ç¦æ­¢å¡«å……ï¼Œæ¶ˆé™¤å¥‡æ€ªçš„ä¸‰è§’åŒº */
        }

        /* 2. é’ˆå¯¹è½¦ç«™ (æ‰€æœ‰ ID ä»¥ "station_" å¼€å¤´çš„å…ƒç´ ) */
        [id^="station_"].disabled {
            fill: #dcdcdc !important;     /* å¡«å……å˜ç° */
            fill-opacity: 0.3 !important;

            stroke: #dcdcdc !important;      /*è½¦ç«™é€šå¸¸ä¸éœ€è¦æè¾¹ï¼Œæˆ–è€…ä¿æŒåŸæ ·*/
        }

        /* --- ä¿¡æ¯å¼¹çª—æ ·å¼ --- */
        #info-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 50vh; /* æœ€å¤šå ä¸€åŠå±å¹• */
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 200; /* æ¯”æ§åˆ¶æ æ›´é«˜ */
            border-radius: 12px 12px 0 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            box-sizing: border-box;
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
        }

        .modal-header h3 { margin: 0; font-size: 1.1em; }

        .modal-body { padding: 15px; padding-bottom: 0px; font-size: 0.9em; line-height: 1.6; }

        .info-block { margin-bottom: 15px; }
        .info-label { font-weight: bold; color: #666; display: block; margin-bottom: 4px; }
        .info-value { color: #333; }
        .dep-list { font-family: monospace; background: #f5f5f5; padding: 5px; border-radius: 4px; word-break: break-all;}
    </style>
</head>

<body>

    <div id="map-container">
        <div id="loading-tip" style="position:absolute; top: 40%; width: 100%; text-align: center; color: #666;">
            æ­£åœ¨åŠ è½½åœ°å›¾èµ„æº...
        </div>
    </div>

    <div id="controls">
        <div class="status-bar">
            <div class="time-display" id="clock">12:00</div>
            <label class="mode-switch">
                <input type="checkbox" id="live-toggle" checked> å®æ—¶æ¨¡å¼
            </label>
        </div>

        <div class="slider-wrapper">
            <div class="visual-track"></div>
            <div class="visual-thumb" id="custom-thumb"></div>

            <input type="range" id="time-slider" min="0" max="10000" value="0">
        </div>

        <div id="slider-hint" style="font-size: 12px; color: #999; text-align: center; margin-top: -10px; pointer-events: none;">
            æ­¤åŒºåŸŸä¹Ÿå¯æ‹–åŠ¨è¿›åº¦æ¡, é˜²æ­¢æ‰‹æŒ‡é®æŒ¡
        </div>
    </div>

    <div id="info-modal" style="display: none;">
        <div class="modal-header">
            <h3 id="modal-title">ç«™ç‚¹åç§°</h3>
            <button onclick="closeModal()" style="padding: 5px 10px;">Ã—</button>
        </div>
        <div id="modal-content" class="modal-body"></div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // ================= é…ç½®åŒºåŸŸ =================

        // ã€æ–°å¢ã€‘è½¦ç«™ç¼–å·ä¿®æ­£è¡¨
        // æ ¼å¼: "çº¿è·¯ç¼–å·_JSONä¸­çš„è½¦ç«™å·": "SVGä¸­çš„è½¦ç«™å·"
        const STATION_ID_FIX_MAP = {
            "330103_0112": "0330", // æ­¦æ—å¹¿åœº (3å·çº¿å´å±±å‰æ‘-æ˜Ÿæ¡¥, JSONåŸå·:0112)
            "330103_0113": "0331", // è¥¿æ¹–æ–‡åŒ–å¹¿åœº (3å·çº¿å´å±±å‰æ‘-æ˜Ÿæ¡¥, JSONåŸå·:0113)
            "330103_0501": "0315", // ç»¿æ±€è·¯ (3å·çº¿å´å±±å‰æ‘-æ˜Ÿæ¡¥, JSONåŸå·:0501)
            "330103_1902": "0312", // ç«è½¦è¥¿ç«™ (3å·çº¿å´å±±å‰æ‘-æ˜Ÿæ¡¥, JSONåŸå·:1902)
            "330104_0106": "0409", // è¿‘æ±Ÿ (4å·çº¿, JSONåŸå·:0106)
            "330104_0116": "0417", // ç«è½¦ä¸œç«™ (4å·çº¿, JSONåŸå·:0116)
            "330104_0117": "0418", // å½­åŸ  (4å·çº¿, JSONåŸå·:0117)
            "330104_0213": "0413", // é’±æ±Ÿè·¯ (4å·çº¿, JSONåŸå·:0213)
            "330104_0336": "0423", // æ–°å¤©åœ°è¡— (4å·çº¿, JSONåŸå·:0336)
            "330106_0105": "0632", // æ±Ÿé™µè·¯ (6å·çº¿æ¡‚èŠ±è¥¿è·¯-æ¸æ¡”å¼„, JSONåŸå·:0105)
            "330106_0403": "0626", // ä¸­åŒ»è¯å¤§å­¦ (6å·çº¿æ¡‚èŠ±è¥¿è·¯-æ¸æ¡”å¼„, JSONåŸå·:0403)
            "330107_0133": "0717", // è§å±±å›½é™…æœºåœº (7å·çº¿, JSONåŸå·:0133)
            "330107_0940": "0704", // è§‚éŸ³å¡˜ (7å·çº¿, JSONåŸå·:0940)
            "330109_0121": "0950", // å®¢è¿ä¸­å¿ƒ (9å·çº¿, JSONåŸå·:0121)
            "330110_0222": "1004", // å­¦é™¢è·¯ (10å·çº¿, JSONåŸå·:0222)
            "330118_0105": "0632", // æ±Ÿé™µè·¯ (6å·çº¿åŒæµ¦-æ¸æ¡”å¼„, JSONåŸå·:0105)
            "330118_0403": "0626", // ä¸­åŒ»è¯å¤§å­¦ (6å·çº¿åŒæµ¦-æ¸æ¡”å¼„, JSONåŸå·:0403)
            "330119_0112": "0330", // æ­¦æ—å¹¿åœº (3å·çº¿çŸ³é©¬-æ˜Ÿæ¡¥, JSONåŸå·:0112)
            "330119_0113": "0331", // è¥¿æ¹–æ–‡åŒ–å¹¿åœº (3å·çº¿çŸ³é©¬-æ˜Ÿæ¡¥, JSONåŸå·:0113)
            "330122_0501": "1612", // ç»¿æ±€è·¯ (16å·çº¿, JSONåŸå·:0501)
            "330123_0133": "1917", // è§å±±å›½é™…æœºåœº (19å·çº¿, JSONåŸå·:0133)
            "330123_0718": "1918", // æ°¸ç››è·¯ (19å·çº¿, JSONåŸå·:0718)
        };
        // ===================================================

        // è¾…åŠ©å‡½æ•°ï¼šè·å–ä¿®æ­£åçš„ ID
        function getFixedStationNo(lineNo, rawStationNo) {
            const key = `${lineNo}_${rawStationNo}`;
            // å¦‚æœè¡¨é‡Œæœ‰ä¿®æ­£å€¼ï¼Œå°±ç”¨ä¿®æ­£å€¼ï¼›å¦åˆ™ç”¨åŸå§‹å€¼
            return STATION_ID_FIX_MAP[key] || rawStationNo;
        }

        // ... ä½ çš„ SVG_URL ç­‰å…¶ä»–é…ç½® ...
        const SVG_URL = 'map.svg';

        // ================= å…¨å±€å˜é‡ =================
        let scheduleMap = {};
        let stationDependencyMap = {}; // æ–°å¢ï¼šå­˜å‚¨ { "station_ID": ["seg_ID_1", "seg_ID_2"...] }
        let stationRawData = {}; // ã€æ–°å¢ã€‘å­˜å‚¨äººç±»å¯è¯»çš„è½¦ç«™æ—¶åˆ»è¡¨ä¿¡æ¯ { "0101": Object }
        let activeSegmentsCache = new Set();
        let isLiveMode = true;
        let mapPanzoom;
        // ã€æ–°å¢ã€‘å­˜å‚¨è¢«è¯†åˆ«ä¸ºâ€œæš‚æœªå¼€é€šâ€çš„ ID é›†åˆ
        let unopenedSet = new Set();
        // ã€å…³é”®ä¿®å¤1ã€‘å°† UI å…ƒç´ æå‡ä¸ºå…¨å±€å˜é‡
        let slider, clock, liveToggle;
        let visualThumb; // æ–°å¢ï¼šè§†è§‰æŒ‡é’ˆ
        // ================= éçº¿æ€§æ»‘å—é…ç½® (çµæ•åº¦æ§åˆ¶) =================
        // å®šä¹‰ä¸€å¤©çš„èµ·å§‹æ—¶é—´: 04:00 (240åˆ†) åˆ° æ¬¡æ—¥ 04:00 (1680åˆ†)
        const START_MIN = 240;
        const END_MIN = 1680;

        // æ—¶é—´åˆ†æ®µç­–ç•¥ (æƒé‡ weight æ€»å’Œå¿…é¡»ä¸º 100)
        const TIME_SEGMENTS = [
            // 1. æ—©é—´å¯åŠ¨ (04:00 - 06:30): æƒé‡ 20%
            { endMinute: 390,  weight: 20 },
            // 2. ç™½å¤©å¹³å³° (06:30 - 21:30): æƒé‡ 15% (ä¸¥é‡å‹ç¼©ï¼Œå› ä¸ºä¸éœ€è¦ç»†çœ‹)
            { endMinute: 1290, weight: 15 },
            // 3. æ™šé—´åœè¿ (21:30 - 00:30): æƒé‡ 55% (ğŸŒŸæé«˜çµæ•åº¦ï¼Œæ‹‰é•¿æ˜¾ç¤º)
            { endMinute: 1470, weight: 55 },
            // 4. æ·±å¤œæ—¶æ®µ (00:30 - 04:00): æƒé‡ 10%
            { endMinute: 1680, weight: 10 }
        ];

        // ç®—æ³•ï¼šæ»‘å—ä½ç½® (0-10000) -> å®é™…åˆ†é’Ÿ
        function getMinutesFromSlider(sliderVal) {
            const percent = sliderVal / 10000 * 100;
            let accWeight = 0;
            let prevMin = START_MIN;

            for (const seg of TIME_SEGMENTS) {
                if (percent <= accWeight + seg.weight) {
                    const segPercent = (percent - accWeight) / seg.weight;
                    return Math.floor(prevMin + (seg.endMinute - prevMin) * segPercent);
                }
                accWeight += seg.weight;
                prevMin = seg.endMinute;
            }
            return END_MIN;
        }

        // ç®—æ³•ï¼šå®é™…åˆ†é’Ÿ -> æ»‘å—ä½ç½® (0-10000)
        function getSliderFromMinutes(minutes) {
            if (minutes < START_MIN) minutes += 1440; // è·¨æ—¥ä¿®æ­£
            if (minutes > END_MIN) minutes = END_MIN;

            let accWeight = 0;
            let prevMin = START_MIN;

            for (const seg of TIME_SEGMENTS) {
                if (minutes <= seg.endMinute) {
                    const segPercent = (minutes - prevMin) / (seg.endMinute - prevMin);
                    const totalPercent = accWeight + (segPercent * seg.weight);
                    return Math.floor(totalPercent / 100 * 10000);
                }
                accWeight += seg.weight;
                prevMin = seg.endMinute;
            }
            return 10000;
        }
        // ================= å·¥å…·å‡½æ•° =================
        function parseTime(timeStr) {
            if (!timeStr || typeof timeStr !== 'string') return null;
            const cleanStr = timeStr.trim();
            if (cleanStr === "") return null;
            const parts = cleanStr.split(':');
            if (parts.length < 2) return null;
            let h = parseInt(parts[0], 10);
            let m = parseInt(parts[1], 10);
            if (isNaN(h) || isNaN(m)) return null;
            if (h < 4) h += 24;
            return h * 60 + m;
        }

        function formatTime(minutes) {
            let h = Math.floor(minutes / 60);
            let m = Math.floor(minutes % 60);
            if (h >= 24) h -= 24;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }
        // ================= æ–°å¢ï¼šåè½¬ç®­å¤´æ–¹å‘ =================
        function flipArrow(arrow) {
            const map = {
                'â†’': 'â†', 'â†': 'â†’',
                'â†‘': 'â†“', 'â†“': 'â†‘',
                'â†—': 'â†™', 'â†™': 'â†—',
                'â†˜': 'â†–', 'â†–': 'â†˜'
            };
            return map[arrow] || arrow;
        }
        // ================= ä¿®æ­£ï¼šåŸºäº Path åˆ‡çº¿çš„å‡ ä½•æ–¹å‘è®¡ç®— =================
        function getArrowIcon(segId, stationId) {
            const path = document.getElementById(segId);
            const station = document.getElementById(stationId);

            // å¿…é¡»å­˜åœ¨ä¸”å¿…é¡»æ˜¯ path å…ƒç´ 
            if (!path || !station || typeof path.getPointAtLength !== 'function') return '';

            try {
                // 1. è·å–ç«™ç‚¹ä¸­å¿ƒåæ ‡
                // æ³¨æ„ï¼šå¦‚æœç«™ç‚¹æ˜¯åœ¨ group <g> é‡Œï¼ŒgetBBox å¯èƒ½å–åˆ°çš„æ˜¯ç›¸å¯¹åæ ‡
                // ä½†é€šå¸¸ path å’Œ station åœ¨åŒä¸€åæ ‡ç³»ä¸‹ï¼Œç›´æ¥æ¯”è¾ƒæ˜¯å¯ä»¥çš„
                const sBox = station.getBBox();
                const sCx = sBox.x + sBox.width / 2;
                const sCy = sBox.y + sBox.height / 2;

                // 2. è·å–è·¯å¾„çš„æ€»é•¿åº¦
                const len = path.getTotalLength();
                if (len < 2) return ''; // è·¯å¾„å¤ªçŸ­ç®—ä¸å‡†

                // 3. è·å–è·¯å¾„ä¸¤ç«¯åæ ‡ (èµ·ç‚¹ vs ç»ˆç‚¹)
                const pStart = path.getPointAtLength(0);
                const pEnd = path.getPointAtLength(len);

                // 4. è®¡ç®—ä¸¤ç«¯åˆ°ç«™ç‚¹ä¸­å¿ƒçš„è·ç¦»
                const distStart = Math.sqrt(Math.pow(pStart.x - sCx, 2) + Math.pow(pStart.y - sCy, 2));
                const distEnd = Math.sqrt(Math.pow(pEnd.x - sCx, 2) + Math.pow(pEnd.y - sCy, 2));

                let dx, dy;

                // 5. åˆ¤æ–­å“ªä¸€å¤´æ˜¯â€œå‡ºå‘ç«¯â€
                // æˆ‘ä»¬è¦è®¡ç®—çš„æ˜¯ã€è¿œç¦»ç«™ç‚¹ã€‘çš„æ–¹å‘å‘é‡

                if (distStart < distEnd) {
                    // èµ·ç‚¹ç¦»ç«™è¿‘ -> é¡ºç€è·¯å¾„èµ° (0 -> 2)
                    const p0 = path.getPointAtLength(0);
                    const p1 = path.getPointAtLength(2); // å–2ä¸ªå•ä½é•¿åº¦å¤„çš„ç‚¹
                    dx = p1.x - p0.x;
                    dy = p1.y - p0.y;
                } else {
                    // ç»ˆç‚¹ç¦»ç«™è¿‘ -> é€†ç€è·¯å¾„èµ° (len -> len-2)
                    // æ³¨æ„ï¼šå› ä¸ºæ˜¯ç®—å‡ºç«™æ–¹å‘ï¼Œæ‰€ä»¥æ˜¯ ç»ˆç‚¹ -> å¾€å›é€€ä¸€ç‚¹çš„ç‚¹
                    const p0 = path.getPointAtLength(len);
                    const p1 = path.getPointAtLength(len - 2);
                    dx = p1.x - p0.x;
                    dy = p1.y - p0.y;
                }

                // 6. è®¡ç®—è§’åº¦
                // SVGåæ ‡ç³»ä¸­ Yè½´å‘ä¸‹ï¼ŒMath.atan2(dy, dx) ç®—å‡ºæ¥çš„æ˜¯æ ‡å‡†ç¬›å¡å°”è§’åº¦
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                const deg = (angle + 360) % 360;

                // 7. æ˜ å°„åˆ° 8 ä¸ªæ–¹å‘
                if (deg >= 337.5 || deg < 22.5) return 'â†’';
                if (deg >= 22.5 && deg < 67.5) return 'â†˜';
                if (deg >= 67.5 && deg < 112.5) return 'â†“';
                if (deg >= 112.5 && deg < 157.5) return 'â†™';
                if (deg >= 157.5 && deg < 202.5) return 'â†';
                if (deg >= 202.5 && deg < 247.5) return 'â†–';
                if (deg >= 247.5 && deg < 292.5) return 'â†‘';
                if (deg >= 292.5 && deg < 337.5) return 'â†—';

            } catch (e) {
                console.warn('è®¡ç®—åˆ‡çº¿æ–¹å‘å¤±è´¥', segId, e);
            }
            return '';
        }
        // å…¨å±€å˜é‡
        let zoomBehavior;
        let svgSelection;
        let gSelection;

        async function loadSVG() {
            try {
                const response = await fetch(SVG_URL);
                if (!response.ok) throw new Error('SVG åŠ è½½å¤±è´¥');
                let svgText = await response.text();

                // 1. æ¸…æ´— SVG
                svgText = svgText.replace(/<svg:svg/g, '<svg').replace(/<\/svg:svg>/g, '</svg>');
                // å»æ‰åŸæœ¬å†™æ­»çš„å®½é«˜
                svgText = svgText.replace(/width="[^"]*"/, '').replace(/height="[^"]*"/, '');

                const container = document.getElementById('map-container');
                container.innerHTML = '';

                // 2. è§£æ SVG å­—ç¬¦ä¸²è·å– ViewBox
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                const originalSvg = doc.querySelector('svg');

                if (!originalSvg) throw new Error("æ— æ•ˆçš„ SVG");

                // è·å–åŸå§‹ ViewBox æ•°æ® (ç”¨äºè®¡ç®—ï¼Œä½†ä¸å†™åœ¨ DOM ä¸Š)
                const viewBoxAttr = originalSvg.getAttribute('viewBox');
                if (!viewBoxAttr) throw new Error("SVG ç¼ºå°‘ viewBox å±æ€§");

                const vb = viewBoxAttr.split(/[\s,]+/).map(parseFloat);
                const vbX = vb[0] || 0;
                const vbY = vb[1] || 0;
                const vbWidth = vb[2];
                const vbHeight = vb[3];

                // 3. æ„å»ºæ–°çš„ SVG ç»“æ„ (D3 ç‹¬è£æ¨¡å¼)
                // å…³é”®ç‚¹ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ svgï¼Œå¹¶ä¸”ã€ä¸è®¾ç½® viewBoxã€‘
                // è¿™æ · SVG çš„ 1ä¸ªå•ä½ å°±ä¸¥æ ¼ç­‰äº å±å¹•ä¸Šçš„ 1ä¸ªåƒç´ 
                // æˆ‘ä»¬å®Œå…¨é  D3 çš„ scale æ¥ç¼©æ”¾å®ƒ
                const newSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                newSvg.style.width = "100%";
                newSvg.style.height = "100%";
                newSvg.style.display = "block";
                newSvg.style.overflow = "hidden"; // éšè—æº¢å‡º

                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                g.id = "map-viewport";

                // è½¬ç§»å†…å®¹
                while (originalSvg.firstChild) {
                    g.appendChild(originalSvg.firstChild);
                }
                newSvg.appendChild(g);
                container.appendChild(newSvg);

                // 4. D3 åˆå§‹åŒ–
                svgSelection = d3.select(newSvg);
                gSelection = d3.select(g);

                zoomBehavior = d3.zoom()
                    .scaleExtent([0.1, 50]) // å…è®¸ç¼©æ”¾çš„èŒƒå›´
                    .on("start", () => {
                        gSelection.style("shape-rendering", "optimizeSpeed");
                    })
                    .on("zoom", (event) => {
                        gSelection.attr("transform", event.transform);
                    })
                    .on("end", () => {
                        gSelection.style("shape-rendering", "geometricPrecision");
                    });

                // ... (å‰é¢çš„ä»£ç ä¸å˜) ...

                svgSelection.call(zoomBehavior)
                    .on("dblclick.zoom", null) // ç¦ç”¨åŒå‡»ç¼©æ”¾
                    .on("click", (event) => {
                        // ã€æ ¸å¿ƒä¿®å¤ã€‘D3 ä¸“å±çš„ç‚¹å‡»åˆ¤å®šé€»è¾‘

                        // 1. å¦‚æœ event.defaultPrevented ä¸º trueï¼Œè¯´æ˜åˆšæ‰å‘ç”Ÿäº†æ‹–æ‹½æˆ–ç¼©æ”¾
                        //    è¿™æ—¶å€™æˆ‘ä»¬åº”è¯¥ä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥è¿”å›ã€‚
                        if (event.defaultPrevented) return;

                        // 2. å¦‚æœæ²¡å‘ç”Ÿæ‹–æ‹½ï¼Œè¯´æ˜æ˜¯çº¯ç‚¹å‡»ï¼Œæ‰‹åŠ¨è°ƒç”¨ä½ çš„å¤„ç†å‡½æ•°
                        // D3 v7 çš„ event å‚æ•°å®Œå…¨å…¼å®¹åŸç”Ÿ Event å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä¼ è¿‡å»
                        handleMapClick(event);
                    });

                // ... (åé¢çš„ä»£ç ä¸å˜) ...

                // 5. ã€å…³é”®ã€‘è®¡ç®—åˆå§‹çŠ¶æ€ (é€‚åº”é«˜åº¦)
                const containerWidth = container.clientWidth;
                const containerHeight = container.clientHeight;

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ k
                // ç›®æ ‡ï¼šè®© SVG çš„ vbHeight æ˜¾ç¤ºä¸º containerHeight
                const k = containerHeight / vbHeight;

                // è®¡ç®—å¹³ç§» tx, ty
                // 1. å…ˆæŠŠ SVG åŸç‚¹ (vbX, vbY) ç§»åˆ° (0,0): -vbX*k, -vbY*k
                // 2. å‚ç›´æ–¹å‘: æ—¢ç„¶æ˜¯é€‚åº”é«˜åº¦ï¼Œå°±æ˜¯é¡¶æ»¡ï¼Œä¸éœ€è¦é¢å¤–åç§» (æˆ–è€…å±…ä¸­: (ch - vh*k)/2 )
                // 3. æ°´å¹³æ–¹å‘: å±…ä¸­æ˜¾ç¤º -> (å±å¹•å®½ - ç¼©æ”¾åçš„å›¾å®½) / 2

                const tx = (containerWidth - vbWidth * k) / 2 - (vbX * k);
                const ty = (containerHeight - vbHeight * k) / 2 - (vbY * k);

                // ç”Ÿæˆå¹¶åº”ç”¨å˜æ¢
                const initialTransform = d3.zoomIdentity
                    .translate(tx, ty)
                    .scale(k);

                svgSelection.call(zoomBehavior.transform, initialTransform);

                console.log(`D3 åˆå§‹åŒ–å®Œæˆ. Scale: ${k.toFixed(4)}, Translate: ${tx.toFixed(1)}, ${ty.toFixed(1)}`);

            } catch (e) {
                console.error(e);
                alert("SVG åŠ è½½å¤±è´¥: " + e.message);
            }
        }

        async function loadAllData() {
            try {
                const response = await fetch('data/file_list.json');
                if (!response.ok) throw new Error('æ— æ³•è¯»å–æ–‡ä»¶åˆ—è¡¨ file_list.json');
                const fileList = await response.json();

                const promises = fileList.map(filename =>
                    fetch(`data/${filename}`).then(res => res.json())
                );
                const results = await Promise.all(promises);

                let allStations = [];
                results.forEach(data => {
                    if (data && data.result && data.result.station_list) {
                        allStations = allStations.concat(data.result.station_list);
                    }
                });
                return allStations;
            } catch (e) {
                console.error(e);
                return [];
            }
        }

        // ================= ä¿®æ”¹ï¼šå¤„ç†æœªå¼€é€š/æ— æ•°æ®å…ƒç´  (å¸¦è¯¦ç»†æ—¥å¿—) =================
        function disableUnopenedElements() {
            console.log("æ­£åœ¨æ¸…ç†æœªå¼€é€šç«™ç‚¹å’Œçº¿è·¯...");

            // 1. é‡ç½®é›†åˆ
            unopenedSet.clear();

            // 2. å®šä¹‰ä¸´æ—¶æ•°ç»„ç”¨äºæ—¥å¿—æ‰“å°
            const disabledSegs = [];     // å­˜å‚¨è¢«æ¸…ç†çš„çº¿è·¯ ID
            const disabledStations = []; // å­˜å‚¨è¢«æ¸…ç†çš„è½¦ç«™ ID

            // 3. æ¸…ç†çº¿è·¯ (Segments)
            const allSegments = document.querySelectorAll('[id^="seg_"]');
            allSegments.forEach(el => {
                // å¦‚æœè¿™ä¸ª ID ä¸åœ¨æ—¶åˆ»è¡¨é‡Œ
                if (!scheduleMap[el.id]) {
                    el.classList.add('disabled');
                    el.classList.add('not-in-service');

                    // é€»è¾‘ç”¨ï¼šåŠ å…¥ Set
                    unopenedSet.add(el.id);
                    // æ—¥å¿—ç”¨ï¼šåŠ å…¥ Array
                    disabledSegs.push(el.id);
                }
            });

            // 4. æ¸…ç†è½¦ç«™ (Stations)
            const allStations = document.querySelectorAll('[id^="station_"]');
            allStations.forEach(el => {
                // å¦‚æœè¿™ä¸ª ID ä¸åœ¨ä¾èµ–è¡¨é‡Œ
                if (!stationDependencyMap[el.id]) {
                    el.classList.add('disabled');
                    el.classList.add('not-in-service');

                    // é€»è¾‘ç”¨ï¼šåŠ å…¥ Set
                    unopenedSet.add(el.id);
                    // æ—¥å¿—ç”¨ï¼šåŠ å…¥ Array
                    disabledStations.push(el.id);
                }
            });

            console.log(`æ¸…ç†å®Œæˆ: å…±æ ‡è®° ${unopenedSet.size} ä¸ªæœªå¼€é€šå…ƒç´ ã€‚`);

            // 5. è¾“å‡ºè¯¦ç»†æ¸…å• (ä½¿ç”¨æŠ˜å ç»„)
            if (disabledSegs.length > 0) {
                console.groupCollapsed(`ğŸš« æœªå¼€é€šåŒºé—´æ¸…å• (${disabledSegs.length}) - ç‚¹å‡»å±•å¼€`);
                console.log(disabledSegs);
                console.groupEnd();
            }

            if (disabledStations.length > 0) {
                console.groupCollapsed(`ğŸš« æœªå¼€é€šè½¦ç«™æ¸…å• (${disabledStations.length}) - ç‚¹å‡»å±•å¼€`);
                console.log(disabledStations);
                console.groupEnd();
            }
        }

        // ================= ä¿®å¤ç‰ˆ processData (æ”¯æŒæ—¶åˆ»è¡¨åˆå¹¶) =================
        function processData(stationList) {
            const map = {};

            // 1. æ’åº
            stationList.sort((a, b) => {
                if (a.line_no !== b.line_no) return a.line_no - b.line_no;
                return a.up_ordinal - b.up_ordinal;
            });

            // è¾…åŠ©å‡½æ•°ï¼šæŸ¥æ‰¾æœ‰æ•ˆ ID
            function findValidId(prefix, id1, id2) {
                const candidate1 = `${prefix}_${id1}_${id2}`;
                const candidate2 = `${prefix}_${id2}_${id1}`;
                if (document.getElementById(candidate1)) return candidate1;
                if (document.getElementById(candidate2)) return candidate2;
                return null;
            }

            function isSameId(a, b) {
                if (a === null || b === null || a === undefined || b === undefined) return false;
                return String(a).trim() === String(b).trim();
            }

            // å¡«è¡¥ç¼éš™
            function fillGapSegments(prefix, startNo, endNo, timeWindow) {
                if (!startNo || !endNo || startNo.length < 4 || endNo.length < 4) return;
                const linePrefix = startNo.substring(0, 2);
                if (endNo.substring(0, 2) !== linePrefix) return;
                const startIdx = parseInt(startNo.substring(2), 10);
                const endIdx = parseInt(endNo.substring(2), 10);
                const step = startIdx < endIdx ? 1 : -1;
                if (Math.abs(endIdx - startIdx) <= 1) return;
                let curr = startIdx;
                let safety = 0;
                while (curr !== endIdx && safety < 50) {
                    safety++;
                    const next = curr + step;
                    const segStart = `${linePrefix}${curr.toString().padStart(2, '0')}`;
                    const segEnd = `${linePrefix}${next.toString().padStart(2, '0')}`;
                    const gapId = findValidId(prefix, segStart, segEnd);
                    if (gapId) map[gapId] = timeWindow;
                    curr = next;
                }
            }

            // ================= ã€æ ¸å¿ƒä¿®æ”¹ï¼šé¢„å¤„ç† StationRawDataã€‘ =================
            // å…ˆæ¸…ç©ºï¼Œé˜²æ­¢æ—§æ•°æ®æ®‹ç•™
            stationRawData = {};

            // éå†æ‰€æœ‰æ•°æ®ï¼ŒæŒ‰ ID åˆå¹¶æ—¶åˆ»è¡¨
            stationList.forEach(s => {
                // è·å–ä¿®æ­£åçš„ ID
                const fixedId = (typeof getFixedStationNo === 'function') ?
                                getFixedStationNo(s.line_no, s.station_no) : s.station_no;

                if (!stationRawData[fixedId]) {
                    // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸ªç«™ï¼Œåˆå§‹åŒ–
                    stationRawData[fixedId] = {
                        name: s.station_name,
                        line: s.line_name, // è®°å½•ç¬¬ä¸€æ¡é‡åˆ°çš„çº¿è·¯å
                        timetables: []     // å®¹å™¨
                    };
                }

                // ã€åˆå¹¶é€»è¾‘ã€‘å°†å½“å‰æ•°æ®çš„æ—¶åˆ»è¡¨è¿½åŠ åˆ°æ•°ç»„ä¸­
                if (s.first_last_weekdays && Array.isArray(s.first_last_weekdays)) {
                    // ä½¿ç”¨ push(...array) å±•å¼€è¿½åŠ 
                    stationRawData[fixedId].timetables.push(...s.first_last_weekdays);

                    // å¯é€‰ï¼šå¦‚æœçº¿è·¯åä¸åŒï¼ˆæ¯”å¦‚æ”¯çº¿ï¼‰ï¼Œå¯ä»¥æ‹¼æ¥åˆ° line å­—æ®µé‡Œ
                    // ä½†ä¸ºäº†ç•Œé¢æ•´æ´ï¼Œé€šå¸¸ä¿ç•™ä¸»çº¿åæˆ–ä¸åšå¤„ç†å³å¯
                }
            });
            // ====================================================================

            // 2. ç”ŸæˆåŒºé—´ Map
            for (let i = 0; i < stationList.length - 1; i++) {
                const curr = stationList[i];
                const next = stationList[i + 1];

                const currNo = (typeof getFixedStationNo === 'function') ?
                               getFixedStationNo(curr.line_no, curr.station_no) : curr.station_no;
                const nextNo = (typeof getFixedStationNo === 'function') ?
                               getFixedStationNo(next.line_no, next.station_no) : next.station_no;

                if (curr.line_no !== next.line_no) continue;

                // å…œåº•åˆ¤å®š
                const isLinePhysicalEnd = (i === stationList.length - 2) || (stationList[i+2] && stationList[i+2].line_no !== curr.line_no);

                // --- ä¸Šè¡Œ ---
                let upStart = Infinity, upEnd = -Infinity, hasUp = false;
                let isNextIsTerminal = false;

                if (curr.first_last_weekdays) {
                    curr.first_last_weekdays.forEach(plan => {
                        if (plan.up_first_time && plan.up_last_time) {
                            const s = parseTime(plan.up_first_time);
                            const e = parseTime(plan.up_last_time);
                            if (s !== null && e !== null) {
                                upStart = Math.min(upStart, s);
                                upEnd = Math.max(upEnd, e);
                                hasUp = true;
                                if (isSameId(plan.up_end_station_no, next.station_no)) isNextIsTerminal = true;
                            }
                        }
                    });
                }

                if (hasUp && isFinite(upStart) && isFinite(upEnd)) {
                    const timeWindow = { start: upStart, end: upEnd };
                    const mainId = findValidId('seg_up', currNo, nextNo);
                    if (mainId) map[mainId] = timeWindow;
                    else fillGapSegments('seg_up', currNo, nextNo, timeWindow);

                    const startLoopId = `seg_up_${currNo}_${currNo}`;
                    if (document.getElementById(startLoopId)) map[startLoopId] = timeWindow;

                    if (isNextIsTerminal || isLinePhysicalEnd) {
                        const endLoopId = `seg_up_${nextNo}_${nextNo}`;
                        if (document.getElementById(endLoopId)) map[endLoopId] = timeWindow;
                    }
                }

                // --- ä¸‹è¡Œ ---
                let downStart = Infinity, downEnd = -Infinity, hasDown = false;
                let isCurrIsTerminal = false;

                if (next.first_last_weekdays) {
                    next.first_last_weekdays.forEach(plan => {
                        if (plan.down_first_time && plan.down_last_time) {
                            const s = parseTime(plan.down_first_time);
                            const e = parseTime(plan.down_last_time);
                            if (s !== null && e !== null) {
                                downStart = Math.min(downStart, s);
                                downEnd = Math.max(downEnd, e);
                                hasDown = true;
                                if (isSameId(plan.down_end_station_no, curr.station_no)) isCurrIsTerminal = true;
                            }
                        }
                    });
                }

                if (hasDown && isFinite(downStart) && isFinite(downEnd)) {
                    const timeWindow = { start: downStart, end: downEnd };
                    const mainId = findValidId('seg_down', nextNo, currNo);
                    if (mainId) map[mainId] = timeWindow;
                    else fillGapSegments('seg_down', nextNo, currNo, timeWindow);

                    const startLoopId = `seg_down_${nextNo}_${nextNo}`;
                    if (document.getElementById(startLoopId)) map[startLoopId] = timeWindow;

                    const isDownPhysicalEnd = (i === 0) || (stationList[i-1] && stationList[i-1].line_no !== curr.line_no);
                    if (isCurrIsTerminal || isDownPhysicalEnd) {
                        const endLoopId = `seg_down_${currNo}_${currNo}`;
                        if (document.getElementById(endLoopId)) map[endLoopId] = timeWindow;
                    }
                }
            }
            return map;
        }

        // ================= äº¤äº’é€»è¾‘ï¼šç‚¹å‡»æ˜¾ç¤ºä¿¡æ¯ =================

        const modal = document.getElementById('info-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');

        // å…³é—­å¼¹çª—
        window.closeModal = function() {
            modal.style.display = 'none';
        }

        // æ ¼å¼åŒ–åˆ†é’Ÿæ•°ä¸º HH:mm
        function minToTime(m) {
            if (!isFinite(m)) return "N/A";
            let h = Math.floor(m / 60);
            let min = Math.floor(m % 60);
            if (h >= 24) h -= 24;
            return `${h.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
        }

        // ================= ä¿®å¤ç‰ˆ handleMapClick =================
        function handleMapClick(e) {
            let target = e.target;
            while (target && target.tagName !== 'svg' && !target.id) {
                target = target.parentNode;
            }
            if (!target || !target.id) return;

            const id = target.id;

            // ================== æƒ…å†µ A: ç‚¹å‡»äº†è½¦ç«™ ==================
            if (id.startsWith('station_')) {
                const match = id.match(/station_(\d+)/);
                if (!match) return;

                const stationNo = match[1];
                // ã€ä¿®æ”¹ã€‘ç°åœ¨ç›´æ¥è·å–åˆå¹¶åçš„å¯¹è±¡
                const data = stationRawData[stationNo];
                const dependencies = stationDependencyMap[id] || [];

                if (data) {
                    modalTitle.textContent = `${data.name} (${data.line})`;

                    // === 1. è®¡ç®—æ–¹å‘ç®­å¤´ (ä¼˜å…ˆæ‰¾ç›´è¿ï¼Œæ²¡æœ‰åˆ™æ‰¾è‡ªç¯å¹¶åè½¬) ===
                    let upArrow = '';
                    let downArrow = '';

                    if (dependencies.length > 0) {
                        // A. å¯»æ‰¾æ­£å¸¸çš„å‡ºç«™çº¿è·¯ (ID: seg_up_å½“å‰_ä¸‹ä¸€ç«™)
                        // æ’é™¤æ‰è‡ªç¯çš„æƒ…å†µ (å³æ’é™¤ endsWith current)
                        const upOutSeg = dependencies.find(segId =>
                            segId.startsWith(`seg_up_${stationNo}_`) && !segId.endsWith(`_${stationNo}`)
                        );
                        const downOutSeg = dependencies.find(segId =>
                            segId.startsWith(`seg_down_${stationNo}_`) && !segId.endsWith(`_${stationNo}`)
                        );

                        // B. å¯»æ‰¾è‡ªç¯çº¿è·¯ (ID: seg_up_å½“å‰_å½“å‰)
                        const upLoopSeg = dependencies.find(segId => segId === `seg_up_${stationNo}_${stationNo}`);
                        const downLoopSeg = dependencies.find(segId => segId === `seg_down_${stationNo}_${stationNo}`);

                        // --- ä¸Šè¡Œç®­å¤´è®¡ç®— ---
                        if (upOutSeg) {
                            // æƒ…å†µ1: ä¸­é—´ç«™ï¼Œç›´æ¥ç”¨å‡ºç«™çº¿è·¯æ–¹å‘
                            upArrow = getArrowIcon(upOutSeg, id);
                        } else if (upLoopSeg) {
                            // æƒ…å†µ2: ç»ˆç‚¹ç«™ï¼Œç”¨è‡ªç¯æ–¹å‘å¹¶ã€åè½¬ã€‘(æ¨¡æ‹Ÿæ‰å¤´)
                            const rawArrow = getArrowIcon(upLoopSeg, id);
                            upArrow = flipArrow(rawArrow);
                        }

                        // --- ä¸‹è¡Œç®­å¤´è®¡ç®— ---
                        if (downOutSeg) {
                            downArrow = getArrowIcon(downOutSeg, id);
                        } else if (downLoopSeg) {
                            const rawArrow = getArrowIcon(downLoopSeg, id);
                            downArrow = flipArrow(rawArrow);
                        }
                    }

                    // === 2. æ•°æ®åˆ†ç±»ä¸å»é‡ (æ ¸å¿ƒé€»è¾‘) ===
                    const upList = [];
                    const downList = [];
                    const seen = new Set();

                    // æ³¨æ„ï¼šç°åœ¨ timetables é‡Œå·²ç»åŒ…å«äº†æ‰€æœ‰æ”¯çº¿çš„æ•°æ®
                    data.timetables.forEach(t => {
                        // ã€è¿‡æ»¤æ— æ•ˆæ•°æ®ã€‘
                        // å¦‚æœé¦–æœ«ç­æ—¶é—´å…¨æ˜¯ null æˆ–ç©ºï¼Œè¯´æ˜è¿™ä¸ªæ–¹å‘ä¸å¯ç”¨ï¼ˆæ¯”å¦‚ç»ˆç‚¹ç«™çš„ç»§ç»­å‰è¡Œæ–¹å‘ï¼‰
                        // å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ—¶é—´æœ‰æ•ˆæ‰æ˜¾ç¤º
                        const hasUpTime = t.up_first_time || t.up_last_time;
                        const hasDownTime = t.down_first_time || t.down_last_time;

                        // å¤„ç†ä¸Šè¡Œ
                        if (t.up_end_station_name && hasUpTime) {
                            const key = `up_${t.up_end_station_name}_${t.up_first_time}_${t.up_last_time}`;
                            if (!seen.has(key)) {
                                upList.push({
                                    dir: `ä¸Šè¡Œ${upArrow}ğŸŸ¢`,
                                    dest: t.up_end_station_name,
                                    first: t.up_first_time || '--',
                                    last: t.up_last_time || '--'
                                });
                                seen.add(key);
                            }
                        }
                        // å¤„ç†ä¸‹è¡Œ
                        if (t.down_end_station_name && hasDownTime) {
                            const key = `down_${t.down_end_station_name}_${t.down_first_time}_${t.down_last_time}`;
                            if (!seen.has(key)) {
                                downList.push({
                                    dir: `ä¸‹è¡Œ${downArrow}ğŸ”µ`,
                                    dest: t.down_end_station_name,
                                    first: t.down_first_time || '--',
                                    last: t.down_last_time || '--'
                                });
                                seen.add(key);
                            }
                        }
                    });

                    // === 3. ç”Ÿæˆ HTML ===
                    let html = `
                        <div class="info-block">
                            <span class="info-label">è½¦ç«™ ID:</span>
                            <span class="info-value">${id}</span>
                        </div>
                        <div class="info-block"><span class="info-label">é¦–æœ«ç­è½¦æ—¶åˆ»:</span>`;

                    if (upList.length > 0) {
                        upList.forEach(item => {
                            html += `<div style="margin-bottom: 4px;">${item.dir} å¾€ ${item.dest}: ${item.first} / ${item.last}</div>`;
                        });
                    }

                    if (upList.length > 0 && downList.length > 0) {
                        html += `<div style="height: 1px; background: #eee; margin: 6px 0;"></div>`;
                    }

                    if (downList.length > 0) {
                        downList.forEach(item => {
                            html += `<div style="margin-bottom: 4px;">${item.dir} å¾€ ${item.dest}: ${item.first} / ${item.last}</div>`;
                        });
                    }

                    if (upList.length === 0 && downList.length === 0) {
                        html += `<div style="color:#999;">æœ¬ç«™æš‚æ— æœåŠ¡</div>`;
                    }

                    html += `</div>`; // end info-block

                    // // ä¾èµ–ä¿¡æ¯ (ä¿æŒä¸å˜)
                    // html += `<div class="info-block"><span class="info-label">Render ä¾èµ– (è°ƒè¯•ç”¨):</span><div class="dep-list">`;
                    // if (dependencies.length === 0) {
                    //     html += "æ— ä¾èµ– (å­¤å²›)";
                    // } else {
                    //     dependencies.forEach(segId => {
                    //         const isActive = activeSegmentsCache.has(segId);
                    //         const statusIcon = isActive ? "âœ…" : "â¬›";
                    //         html += `<div>${statusIcon} ${segId}</div>`;
                    //     });
                    // }
                    // html += `</div></div>`;

                    modalContent.innerHTML = html;
                    modal.style.display = 'block';
                }
                // é€»è¾‘åˆ†æ”¯ 2: åœ¨æš‚æœªå¼€é€šåˆ—è¡¨ä¸­
                else if (unopenedSet.has(id)) {
                    // å°è¯•è·å– SVG é‡Œçš„ data-name å±æ€§ä½œä¸ºæ ‡é¢˜
                    const svgName = target.getAttribute('data-name') || target.getAttribute('inkscape:label');
                    modalTitle.textContent = svgName ? `${svgName} (æœªå¼€é€š)` : `ç«™ç‚¹ ${stationNo}`;

                    let html = `
                        <div class="info-block" style="text-align: center; padding-bottom: 5px;">
                            <div style="font-size: 40px; margin-bottom: 10px;">ğŸš§</div>
                            <h3 style="color: #666; margin: 0;">æš‚æœªå¼€é€š</h3>
                            <p style="color: #999; font-size: 0.9em; margin-top: 5px;">Coming Soon</p>
                        </div>`;
                        // <div class="info-block">
                        //     <span class="info-label">è°ƒè¯• ID:</span>
                        //     <span class="info-value">${id}</span>
                        // </div>

                    modalContent.innerHTML = html;
                    modal.style.display = 'block';
                }
                // é€»è¾‘åˆ†æ”¯ 3: æ— æ•°æ® (æ—¢æ²¡æ•°æ®ï¼Œä¹Ÿä¸æ˜¯è¢«ç¨‹åºæ ‡è®°ä¸ºæœªå¼€é€šçš„ï¼Œå±äºæœªçŸ¥é”™è¯¯)
                else {
                    modalTitle.textContent = "æ•°æ®ç¼ºå¤±";
                    let html = `
                        <div class="info-block" style="text-align: center; padding-bottom: 5px;">
                            <div style="font-size: 40px; margin-bottom: 10px;">â“</div>
                            <h3 style="color: #666; margin: 0;">æ— æ•°æ®</h3>
                            <p style="color: #999; font-size: 0.9em; margin-top: 5px;">ID æœªçŸ¥æˆ–æ˜ å°„é”™è¯¯</p>
                        </div>
                        <div class="info-block">
                            <span class="info-label">å¼‚å¸¸ ID:</span>
                            <span class="info-value">${id}</span>
                        </div>
                    `;
                    modalContent.innerHTML = html;
                    modal.style.display = 'block';
                }
            }

            // ================== æƒ…å†µ B: ç‚¹å‡»äº†çº¿è·¯ ==================
            else if (id.startsWith('seg_')) {
                const windowData = scheduleMap[id];

                // é€»è¾‘åˆ†æ”¯ 1: æ­£å¸¸æœ‰æ•°æ®
                if (windowData) {
                    modalTitle.textContent = "åŒºé—´çº¿è·¯ä¿¡æ¯";
                    const parts = id.split('_');
                    const dir = parts[1] === 'up' ? 'ä¸Šè¡Œ' : 'ä¸‹è¡Œ';

                    let html = `
                        <div class="info-block">
                            <span class="info-label">åŒºé—´ ID:</span>
                            <span class="info-value">${id}</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">è¿è¥æ–¹å‘:</span>
                            <span class="info-value">${dir}</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">è®¡ç®—å‡ºçš„ç”Ÿæ•ˆçª—å£:</span>
                            <div class="info-value">
                                å¼€å§‹: ${minToTime(windowData.start)} (ç¬¬${windowData.start}åˆ†)<br>
                                ç»“æŸ: ${minToTime(windowData.end)} (ç¬¬${windowData.end}åˆ†)
                            </div>
                        </div>
                        <div class="info-block">
                            <span class="info-label">å½“å‰çŠ¶æ€:</span>
                            <span class="info-value">${activeSegmentsCache.has(id) ? 'ğŸŸ¢ è¿è¥ä¸­' : 'âš« å·²åœè¿'}</span>
                        </div>
                    `;
                    modalContent.innerHTML = html;
                    modal.style.display = 'block';
                }
                // é€»è¾‘åˆ†æ”¯ 2: åœ¨æš‚æœªå¼€é€šåˆ—è¡¨ä¸­
                else if (unopenedSet.has(id)) {
                     modalTitle.textContent = "æœªå¼€é€šåŒºé—´";
                     let html = `
                        <div class="info-block" style="text-align: center; padding-bottom: 5px;">
                            <div style="font-size: 30px; margin-bottom: 10px;">ğŸš«</div>
                            <p style="color: #999;">è¯¥åŒºæ®µæš‚æœªå¼€é€šè¿è¥</p>
                        </div>
                        <div class="info-block">
                            <span class="info-label">åŒºé—´ ID:</span>
                            <span class="info-value">${id}</span>
                        </div>
                     `;
                     modalContent.innerHTML = html;
                     modal.style.display = 'block';
                }
                // é€»è¾‘åˆ†æ”¯ 3: æ— æ•°æ®
                else {
                    // é€šå¸¸çº¿è·¯ä¸å¤ªä¼šè¿›è¿™é‡Œï¼Œé™¤é id æ ¼å¼å¯¹ä½†æ²¡è¢«è¯†åˆ«
                    modalTitle.textContent = "æ•°æ®å¼‚å¸¸";
                     let html = `
                        <div class="info-block" style="text-align: center; padding-bottom: 5px;">
                            <div style="font-size: 30px; margin-bottom: 10px;">âš ï¸</div>
                            <p style="color: #999;">æœªçŸ¥è·¯æ®µ</p>
                        </div>
                        <div class="info-block">
                            <span class="info-label">åŒºé—´ ID:</span>
                            <span class="info-value">${id}</span>
                        </div>
                     `;
                     modalContent.innerHTML = html;
                     modal.style.display = 'block';
                }
            }
        }

        // ================= ä¿®å¤ç‰ˆ generateStationMap (æ”¯æŒéè¿ç»­ID) =================
        function generateStationMap(stationList) {
            const dependencyMap = {};

            // 1. ç¡®ä¿åˆ—è¡¨æ’åº
            stationList.sort((a, b) => {
                if (a.line_no !== b.line_no) return a.line_no - b.line_no;
                return a.up_ordinal - b.up_ordinal;
            });

            // è¾…åŠ©ï¼šè·å–ä¿®æ­£åçš„ SVG ID
            function getID(stationObj) {
                if (!stationObj) return null;
                return (typeof getFixedStationNo === 'function') ?
                       getFixedStationNo(stationObj.line_no, stationObj.station_no) : stationObj.station_no;
            }

            // è¾…åŠ©ï¼šæ£€æŸ¥å¹¶æ·»åŠ ä¾èµ–
            function checkAndAdd(segId, depsList) {
                // 1. æ£€æŸ¥ scheduleMap (æ´»è·ƒä¸­)
                if (scheduleMap[segId]) {
                    depsList.push(segId);
                    return true;
                }
                // 2. æ£€æŸ¥ DOM (æš‚æœªå¼€é€šä½†å­˜åœ¨) - è¿™ä¸€æ­¥ä¿è¯äº†æœªå¼€é€šçš„ç°çº¿ä¹Ÿèƒ½è¢«è¯†åˆ«
                if (document.getElementById(segId)) {
                    depsList.push(segId);
                    return true;
                }
                return false;
            }

            for (let i = 0; i < stationList.length; i++) {
                const curr = stationList[i];
                const prev = stationList[i - 1]; // åˆ—è¡¨é‡Œçš„å‰ä¸€ä¸ªå¯¹è±¡
                const next = stationList[i + 1]; // åˆ—è¡¨é‡Œçš„åä¸€ä¸ªå¯¹è±¡

                // è·å–ä¿®æ­£åçš„ç¼–å·
                const currNo = getID(curr);

                // ä»…å½“ prev/next ä¸å½“å‰ç«™ç‚¹å±äºåŒä¸€æ¡çº¿æ—¶ï¼Œæ‰è§†ä¸ºæœ‰æ•ˆé‚»å±…
                const prevNo = (prev && prev.line_no === curr.line_no) ? getID(prev) : null;
                const nextNo = (next && next.line_no === curr.line_no) ? getID(next) : null;

                // æ”¶é›†ä¾èµ–
                const deps = [];

                // ================= 1. è‡ªç¯ä¾èµ– =================
                const selfUp = `seg_up_${currNo}_${currNo}`;
                const selfDown = `seg_down_${currNo}_${currNo}`;
                if (document.getElementById(selfUp)) deps.push(selfUp);
                if (document.getElementById(selfDown)) deps.push(selfDown);

                // ================= 2. ç‰©ç†é‚»å±…å—…æ¢ (åŸºäºåˆ—è¡¨å…³ç³») =================
                // è¿™é‡Œä¸å†è¿›è¡Œæ•°å­—åŠ å‡ï¼Œè€Œæ˜¯ç›´æ¥æ‹¼æ¥ prevNo å’Œ nextNo

                // --- ä¸Šè¡Œ (Up) ---
                // è¿›ç«™: Prev -> Curr
                if (prevNo) {
                    const seg1 = `seg_up_${prevNo}_${currNo}`; // æ­£å‘
                    const seg2 = `seg_up_${currNo}_${prevNo}`; // åå‘å®¹é”™
                    if (!checkAndAdd(seg1, deps)) checkAndAdd(seg2, deps);
                }
                // å‡ºç«™: Curr -> Next
                if (nextNo) {
                    const seg1 = `seg_up_${currNo}_${nextNo}`;
                    const seg2 = `seg_up_${nextNo}_${currNo}`;
                    if (!checkAndAdd(seg1, deps)) checkAndAdd(seg2, deps);
                }

                // --- ä¸‹è¡Œ (Down) ---
                // è¿›ç«™: Next -> Curr (æ³¨æ„ä¸‹è¡Œæ˜¯åç€å¼€çš„)
                if (nextNo) {
                    const seg1 = `seg_down_${nextNo}_${currNo}`;
                    const seg2 = `seg_down_${currNo}_${nextNo}`;
                    if (!checkAndAdd(seg1, deps)) checkAndAdd(seg2, deps);
                }
                // å‡ºç«™: Curr -> Prev
                if (prevNo) {
                    const seg1 = `seg_down_${currNo}_${prevNo}`;
                    const seg2 = `seg_down_${prevNo}_${currNo}`;
                    if (!checkAndAdd(seg1, deps)) checkAndAdd(seg2, deps);
                }

                // ================= 3. ç»‘å®šåˆ° DOM =================
                const stationIdBase = `station_${currNo}`;

                // åˆ†ä½“å¼ç«™ç‚¹
                const elUp = document.getElementById(`${stationIdBase}_up`);
                if (elUp) {
                    const myDeps = deps.filter(id => id.includes('seg_up') || id === selfUp);
                    dependencyMap[elUp.id] = myDeps;
                }

                const elDown = document.getElementById(`${stationIdBase}_down`);
                if (elDown) {
                    const myDeps = deps.filter(id => id.includes('seg_down') || id === selfDown);
                    dependencyMap[elDown.id] = myDeps;
                }

                // åˆä½“å¼ç«™ç‚¹
                const elMain = document.getElementById(stationIdBase);
                if (elMain) {
                    dependencyMap[elMain.id] = deps;
                }
            }

            return dependencyMap;
        }

        // ================= ä¿®æ”¹åçš„ render å‡½æ•° =================
        function render(currentTimeMinutes) {
            const newActiveSet = new Set();

            // --- 1. è®¡ç®—åŒºé—´çš„çŠ¶æ€ (å’Œä¹‹å‰ä¸€æ ·) ---
            for (const [id, window] of Object.entries(scheduleMap)) {
                if (currentTimeMinutes >= window.start && currentTimeMinutes <= window.end) {
                    newActiveSet.add(id);
                }
            }

            // --- 2. æ›´æ–°åŒºé—´ DOM (å’Œä¹‹å‰ä¸€æ ·) ---
            // å˜ç°
            activeSegmentsCache.forEach(id => {
                if (!newActiveSet.has(id)) {
                    const el = document.getElementById(id);
                    if (el) el.classList.add('disabled');
                }
            });
            // å˜äº®
            newActiveSet.forEach(id => {
                if (!activeSegmentsCache.has(id)) {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('disabled');
                }
            });
            activeSegmentsCache = newActiveSet; // æ›´æ–°ç¼“å­˜

            // --- 3. æ–°å¢ï¼šæ›´æ–°ç«™ç‚¹ (Station) çŠ¶æ€ ---
            // éå†æ‰€æœ‰åœ¨ SVG é‡Œæ‰¾åˆ°çš„ç«™ç‚¹
            for (const [stationId, segIds] of Object.entries(stationDependencyMap)) {
                const el = document.getElementById(stationId);
                if (!el) continue;

                // æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥ä¾èµ–çš„è½¨é“é‡Œï¼Œæ˜¯å¦â€œè‡³å°‘æœ‰ä¸€æ¡â€æ˜¯æ´»è·ƒçš„
                // newActiveSet é‡Œå­˜çš„æ˜¯å½“å‰äº®ç€çš„è½¨é“ ID
                const isStationActive = segIds.some(segId => newActiveSet.has(segId));

                if (isStationActive) {
                    // åªè¦æœ‰ä¸€æ¡è·¯é€šï¼Œç«™ç‚¹å°±äº®
                    if (el.classList.contains('disabled')) {
                        el.classList.remove('disabled');
                    }
                } else {
                    // æ‰€æœ‰è·¯éƒ½ä¸é€š (Array.some è¿”å› false)ï¼Œç«™ç‚¹å˜ç°
                    if (!el.classList.contains('disabled')) {
                        el.classList.add('disabled');
                    }
                }
            }
        }

        function tick() {
            let minutes;
            // æ³¨æ„ï¼šè¿™é‡Œä¸å†ç”¨ 1560ï¼Œè€Œæ˜¯ç”¨æ»‘å—çš„æœ€å¤§ç²¾åº¦ 10000
            const SLIDER_MAX = 10000;

            if (isLiveMode) {
                // --- å®æ—¶æ¨¡å¼ ---
                const now = new Date();
                let h = now.getHours();
                const m = now.getMinutes();
                if (h < 4) h += 24;
                minutes = h * 60 + m;

                // 1. æ ¹æ®æ—¶é—´ -> ç®—å‡ºæ»‘å—åº”è¯¥åœ¨å“ª
                const sliderPos = getSliderFromMinutes(minutes);

                // 2. æ›´æ–°æ»‘å—å’Œçº¢çº¿
                if (slider) slider.value = sliderPos;
                if (visualThumb) visualThumb.style.left = `${sliderPos / SLIDER_MAX * 100}%`;

            } else {
                // --- æ‹–æ‹½æ¨¡å¼ ---
                // 1. è¯»å–æ»‘å—ä½ç½®
                const sliderVal = parseInt(slider.value, 10);

                // 2. æ ¹æ®æ»‘å—ä½ç½® -> ç®—å‡ºæ—¶é—´ (éçº¿æ€§)
                minutes = getMinutesFromSlider(sliderVal);

                // 3. æ›´æ–°çº¢çº¿ (ç›´æ¥ç”¨æ»‘å—ä½ç½®ç®—ç™¾åˆ†æ¯”ï¼Œä¿è¯ç»å¯¹è·Ÿæ‰‹)
                if (visualThumb) visualThumb.style.left = `${sliderVal / SLIDER_MAX * 100}%`;
            }

            // æ›´æ–°æ–‡å­—å’Œåœ°å›¾
            if (clock) clock.textContent = formatTime(minutes);
            render(minutes);

            // å¾ªç¯
            if (isLiveMode) {
                requestAnimationFrame(tick);
            }
        }

        // ================= åˆå§‹åŒ–å…¥å£ =================
        (async function initApp() {
            console.log("å¼€å§‹åŠ è½½èµ„æº...");

            // ã€å…³é”®ä¿®å¤2ã€‘åœ¨è¿™é‡Œè·å– DOM å…ƒç´ å¹¶èµ‹å€¼ç»™å…¨å±€å˜é‡
            slider = document.getElementById('time-slider');
            clock = document.getElementById('clock');
            liveToggle = document.getElementById('live-toggle');
            visualThumb = document.getElementById('custom-thumb'); // è·å–è§†è§‰æŒ‡é’ˆ

            const [_, allStations] = await Promise.all([
                loadSVG(),
                loadAllData()
            ]);

            console.log(`èµ„æºåŠ è½½å®Œæ¯•ï¼Œå…±è·å– ${allStations.length} ä¸ªç«™ç‚¹æ•°æ®`);
            const tip = document.getElementById('loading-tip');
            if (tip) tip.style.display = 'none';

            scheduleMap = processData(allStations);
            console.log("åŒºé—´æ—¶åˆ»è¡¨ç”Ÿæˆ:", scheduleMap);
            // ã€æ–°å¢ã€‘3. ç”Ÿæˆç«™ç‚¹ä¾èµ–è¡¨ (å¿…é¡»åœ¨ scheduleMap ç”Ÿæˆä¹‹å)
            stationDependencyMap = generateStationMap(allStations);
            console.log("ç«™ç‚¹ä¾èµ–å…³ç³»:", stationDependencyMap);
            disableUnopenedElements();
            // ã€å…³é”®ä¿®å¤3ã€‘åˆå§‹åŒ– Diff ç¼“å­˜
            // å‡è®¾ä¸€å¼€å§‹æ‰€æœ‰çº¿è·¯éƒ½æ˜¯äº®çš„ï¼Œå¡«æ»¡ç¼“å­˜ã€‚
            // è¿™æ ·å½“ç¬¬ä¸€å¸§ tick è¿è¡Œæ—¶ï¼Œå¦‚æœå½“å‰æ˜¯æ·±å¤œï¼ŒDiff ç®—æ³•ä¼šå‘ç° (All -> None)ï¼Œä»è€ŒæŠŠçº¿è·¯å˜ç°ã€‚
            activeSegmentsCache = new Set(Object.keys(scheduleMap));

            // åœ¨ initApp å‡½æ•°å†…éƒ¨ï¼Œç»‘å®šäº‹ä»¶ç›‘å¬çš„åœ°æ–¹ï¼š
// ... (å‰é¢çš„ä»£ç ä¸å˜) ...

            // ã€æ–°å¢ã€‘è·å–æç¤ºæ–‡å­—å…ƒç´ 
            const sliderHint = document.getElementById('slider-hint');

            // è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°æç¤ºæ–‡å­—
            function updateHintText() {
                if (sliderHint) {
                    sliderHint.textContent = isLiveMode
                        ? "å®æ—¶æ¨¡å¼, è¿›åº¦æ¡å·²ç¦ç”¨"
                        : "æ­¤åŒºåŸŸä¹Ÿå¯æ‹–åŠ¨è¿›åº¦æ¡, é˜²æ­¢æ‰‹æŒ‡é®æŒ¡";
                }
            }

            // 1. å¤é€‰æ¡†åˆ‡æ¢äº‹ä»¶
            liveToggle.addEventListener('change', (e) => {
                isLiveMode = e.target.checked;

                if (isLiveMode) {
                    // ã€å…³é”®ã€‘å‹¾é€‰æ—¶ï¼Œç«‹å³è¸¢å®ƒä¸€è„šï¼Œè®©å®ƒå¼€å§‹è·‘
                    tick();

                    // å¯é€‰ï¼šç¦ç”¨æ»‘å—ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨è‡ªåŠ¨è·‘çš„æ—¶å€™ä¹±æ‹–
                    slider.disabled = true;
                    // slider.style.opacity = '0.5'; // è§†è§‰å±‚å·²ç»æ¥ç®¡äº†ï¼Œslider æ˜¯é€æ˜çš„ï¼Œä¸ç”¨æ”¹é€æ˜åº¦
                } else {
                    // å–æ¶ˆå‹¾é€‰æ—¶ï¼Œæ¢å¤æ»‘å—æ§åˆ¶
                    slider.disabled = false;
                    // slider.style.opacity = '1';
                }

                // ã€æ–°å¢ã€‘æ›´æ–°æ–‡å­—
                updateHintText();
            });

            slider.addEventListener('input', () => {
                // 1. åªè¦ä¸€å¼€å§‹æ‹–åŠ¨ï¼Œç«‹åˆ»å–æ¶ˆå®æ—¶æ¨¡å¼
                if (isLiveMode) {
                    isLiveMode = false;
                    if (liveToggle) liveToggle.checked = false;
                    slider.disabled = false;

                    // ã€æ–°å¢ã€‘çŠ¶æ€å˜äº†ï¼Œæ›´æ–°æ–‡å­—
                    updateHintText();
                }

                // 2. ç«‹å³æ›´æ–°è§†è§‰æŒ‡é’ˆ (ä¸ºäº†æå…¶è·Ÿæ‰‹)
                // ç›´æ¥ç”¨å½“å‰æ»‘å—çš„å€¼ (0-10000) ç®—ç™¾åˆ†æ¯”
                if (visualThumb) {
                    const val = parseInt(slider.value, 10);
                    const percent = val / 10000 * 100;
                    visualThumb.style.left = `${percent}%`;
                }

                // 3. è§¦å‘ä¸€æ¬¡ tick è®¡ç®—æ—¶é—´å¹¶æ¸²æŸ“åœ°å›¾
                tick();
            });
            // å¯åŠ¨
            tick();
        })();
    </script>
</body>
</html>